define(["base","app/commonApp"],function(e,t){var i=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/resourcemonitor/findPublishResourceByPage",type:"get",contentType:"application/json",data:function(i){t.gridPageFliter(i);var r=e.form.getParams($("#publishRes-form"));var a;if(r){a=$.extend({page:i.page,size:i.size},r)}return a}},columns:[{data:"id",sWidth:"5%"},{data:"taskName",sWidth:"25%"},{data:"resTypeName",sWidth:"20%"},{data:"stateName",sWidth:"25%"},{data:"nextTime",sWidth:"25%"}],columnDefs:[{render:function(e,t,i,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+i.roleId+"' class='cb' cAll = '"+JSON.stringify(i)+"' cid='"+i.roleId+"'/></div>"},targets:0},{render:function(e,t,i,r){if(i.taskName){return"<div>"+i.taskName+"</div>"}else{return"--"}},targets:1},{render:function(e,t,i,r){if(i.resTypeName){return"<div>"+i.resTypeName+"</div>"}else{return"--"}},targets:2},{render:function(e,t,i,r){if(i.stateName){return"<div>"+i.stateName+"</div>"}else{return"--"}},targets:3},{render:function(e,t,i,r){if(i.nextTime){return"<div>"+i.nextTime+"</div>"}else{return"--"}},targets:4}],drawCallback:function(i){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))})}};var a={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,ajax:{url:$.path+"/api/resourcemonitor/findSubscribeResourceByPage",type:"get",contentType:"application/json",data:function(i){t.gridPageFliter(i);var r=e.form.getParams($("#subscibeRes-form"));var a;if(r){a=$.extend({page:i.page,size:i.size},r)}return a}},columns:[{data:"id",sWidth:"5%"},{data:"taskName",sWidth:"20%"},{data:"resTypeName",sWidth:"15%"},{data:"pubEquipmentName",sWidth:"20%"},{data:"stateName",sWidth:"20%"},{data:"nextTime",sWidth:"20%"}],columnDefs:[{render:function(e,t,i,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+i.roleId+"' class='cb' cAll = '"+JSON.stringify(i)+"' cid='"+i.roleId+"'/></div>"},targets:0},{render:function(e,t,i,r){if(i.taskName){return"<div>"+i.taskName+"</div>"}else{return"--"}},targets:1},{render:function(e,t,i,r){if(i.resTypeName){return"<div>"+i.resTypeName+"</div>"}else{return"--"}},targets:2},{render:function(e,t,i,r){if(i.pubEquipmentName){return"<div>"+i.pubEquipmentName+"</div>"}else{return"--"}},targets:3},{render:function(e,t,i,r){if(i.stateName){return"<div>"+i.stateName+"</div>"}else{return"--"}},targets:4},{render:function(e,t,i,r){if(i.nextTime){return"<div>"+i.nextTime+"</div>"}else{return"--"}},targets:5}],drawCallback:function(i){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))})}};var n=function(r,a){i=e.datatables({container:r,option:a,filter:t.gridFilter})};var s=function(){$(".search").on("click",function(){t.search(i)})};var c=function(){$(".reset").off().on("click",function(){t.reset($(this).parents(".ui-searchbar").find("form:visible"),i)})};var u=function(){e.confirm({label:"启用",text:"<div style='text-align:center;font-size:13px;'>确定启用?</div>",confirmCallback:function(){var e=$(".ui-grid .cb:checked").attr("cAll");var r=JSON.parse(e);var a={id:r.id,pubEquipmentId:r.pubEquipmentId,actionType:1,subEquipmentId:r.subEquipmentId,type:0};if($(".ui-grid-linkGroup").find("li.active").attr("key")=="0"){a.actionType=1}else{a.actionType=2}t.submit({url:$.path+"/api/resourcemonitor/startStopTask",params:a,type:"post",callback:function(){t.search(i)}})}})};var d=function(){e.confirm({label:"暂停",text:"<div style='text-align:center;font-size:13px;'>确定暂停?</div>",confirmCallback:function(){var e=$(".ui-grid .cb:checked").attr("cAll");var r=JSON.parse(e);var a={id:r.id,pubEquipmentId:r.pubEquipmentId,actionType:1,subEquipmentId:r.subEquipmentId,type:-1};if($(".ui-grid-linkGroup").find("li.active").attr("key")=="0"){a.actionType=1}else{a.actionType=2}t.submit({url:$.path+"/api/resourcemonitor/startStopTask",type:"post",params:a,callback:function(){t.search(i)}})}})};var o=function(){e.confirm({label:"调度",text:"<div style='text-align:center;font-size:13px;'>确定调度?</div>",confirmCallback:function(){var e=$(".ui-grid .cb:checked").attr("cAll");var r=JSON.parse(e);var a={id:r.id,pubEquipmentId:r.pubEquipmentId,resourceType:2,subEquipmentId:r.subEquipmentId};t.submit({url:$.path+"/api/resourcemonitor/dispatchTask",params:a,type:"post",callback:function(){t.search(i)}})}})};var l=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var e=$(this).attr("key");switch(e){case"0":$("#publishRes-form").show();$("#subscibeRes-form").hide();$(".dispatch").parent().hide();$(".publishRes").show();$(".subscibeResWrapper").hide();n($("#publishRes"),r);break;case"1":$("#publishRes-form").hide();$("#subscibeRes-form").show();$(".dispatch").parent().show();$(".publishRes").hide();$(".subscibeResWrapper").show();n($("#subscibeRes"),a);break}})};var p=function(){$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"0":u();break;case"1":d();break;case"2":o();break}}})};return{main:function(){n($("#publishRes"),r);l();s();c();p()}}});