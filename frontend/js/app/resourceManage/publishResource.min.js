define(["base","app/commonApp"],function(t,e){var a=null;var n=function(t,e,a){var n="";switch(t){case"3":n="<div rid='"+e+"' data-sign='"+a+"'><button rid='"+e+"' type='subscribe' data-sign='"+a+"' class='btn btn-warning check blockCenter'>发布</button><button class='btn btn-link blockCenter disabled'>撤销</button>"+"</div><button class='btn btn-link blockCenter disabled' >删除</button></div>";break;case"5":n="<div rid='"+e+"' data-sign='"+a+"'><button rid='"+e+"' type='subscribe' class='btn btn-warning check blockCenter'>修改</button><button class='btn btn-link blockCenter color-59b0fc'>撤销</button>"+"<button class='btn btn-link disabled blockCenter'>删除</button><button class='btn btn-link disabled blockCenter'>发布</button></div>";break;case"6":n="<div rid='"+e+"' data-sign='"+a+"'><button class='btn btn-warning delect blockCenter'>删除</button><button class='btn btn-link blockCenter disabled'>撤销</button>"+"<button class='btn btn-link blockCenter disabled'>发布</button></div>";break}return n};var l={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/resource/findResResourceByPage",type:"get",contentType:"application/json",data:function(a){e.gridPageFliter(a);var n=t.form.getParams($("#search-form"));var l;if(n){l=$.extend({page:a.page,size:a.size},n)}return l}},columns:[{data:"data",sWidth:"100%"}],columnDefs:[{render:function(t,e,a,l){var c=n(a.state,a.id,a.resType);var i="";var s=a.content;switch(a.resType){case"1":i="<span class='sign color-1e88e5'>"+a.resTypeName+"</span>";break;case"2":i="<span class='sign color-fe245c'>"+a.resTypeName+"</span>";break;case"3":i="<span class='sign color-f2c65d'>"+a.resTypeName+"</span>";break;case"其他":i="<span class='sign color-68baff'>"+a.resTypeName+"</span>";break}if(a.abstracts.length>150){s=a.abstracts.substr(0,150)+"..."}else{s=a.abstracts}var o="<div class='ui-blockGrid-item'>"+"<ul>"+"<li type='photo' style='float:left;width:12%'>"+"<img src='../images/user_default.png'/>"+"</li>"+"<li type='info' style='float:left;width:59%'>"+"<ul class='ui-blockGrid-content'>"+"<li type='title'><a target='_blank' href='"+$.path+"/dssg-portal/index.html#/detail?type="+a.resType+"&id="+a.id+"'>"+a.resName+i+"</a></li>"+"<li class='content'>"+s+"</li>"+"<li style='clear:both;padding-left:22px'>"+"<div class='classify'>"+a.subjectCarategoryName+"</div>"+"<div class='classify'>"+a.industryCategoryName+"</div>"+"</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>提供单位</li>"+"<li type='content'>"+a.companyName+"</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>申请状态</li>"+"<li type='content'>"+a.stateName+"</li>"+"</ul>"+"</li>"+"<li type='buttons' style='float:left;width:11%'>"+c+"<div class='ui-datetime'>"+a.createTime+"</div></li>"+"</ul>"+"</div>";return o},targets:0}],drawCallback:function(t){c();u();d()}};function c(){$(".check").off().on("click",function(){debugger;var n="";var l=$(this).parent().attr("data-sign");switch(l){case"1":n="../html/resourceManage/publishResource/publishResource_publish_db.html";break;case"2":n="../html/resourceManage/publishResource/publishResource_publish_doc.html";break;case"3":n="../html/resourceManage/publishResource/publishResource_publish_api.html";break;case"其他":return;break}modal=t.modal({label:"资源发布",width:1e3,height:500,modalId:$(this).attr("rid"),url:n,drag:true,callback:function(){i(l)},buttons:[{label:"上一步",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(t){steps.back()}},{label:"下一步",id:"step_forward",cls:"btn btn-info forward",style:"display:none",clickEvent:function(){steps.forward(function(){var e=steps.getStep();switch(e){case 0:var a=t.form.validate({form:$("#form1"),checkAll:true});return a;break;case 1:var a=t.form.validate({form:$("#form2"),checkAll:true});return a;break;case 2:return true;case 3:return true;case 4:return true;break}})}},{label:"保存",id:"step_confirm",cls:"btn btn-info confirm",style:"display:none",clickEvent:function(){var t={};switch(l){case"DATA":;break;case"DOC":t={applyResult:$(".doc .applyResult").val(),applyopinion:$(".applyopinion").val()};break;case"API":;break}e.search(a);modal.hide()}}]})})}var i=function(e){var a=[];switch(e){case"DATA":a=[{label:"选择数据源",contentToggle:"#content1"},{label:"关联数据表",contentToggle:"#content2"},{label:"数据项转换",contentToggle:"#content3"},{label:"配置更新",contentToggle:"#content4"},{label:"发布预览",contentToggle:"#content5"}];break;case"DOC":a=[{label:"选择数据源",contentToggle:"#content1"},{label:"选择文件",contentToggle:"#content2"},{label:"发布预览",contentToggle:"#content3"}];break;case"API":a=[{label:"选择数据源",contentToggle:"#content1"},{label:"关联数据表",contentToggle:"#content2"},{label:"输入参数",contentToggle:"#content3"},{label:"输出参数",contentToggle:"#content4"},{label:"接口方式",contentToggle:"#content5"},{label:"发布预览",contentToggle:"#content6"}];break}steps=t.steps({container:$("#ui-steps"),data:a,buttonGroupToggle:modal.modalFooter})};var s=function(){a=t.datatables({container:$("#example"),option:l,filter:e.gridFilter})};var o=function(){$("#search").on("click",function(){e.search(a)})};var r=function(){$("#reset").on("click",function(){e.reset($("#search-form"),a)})};var b=function(){$.ajax({type:"get",url:$.path+"/api/catalog/findDomainResCataLogInfo?name=catalogId&type=1",success:function(e){t.template({container:$(".catalogId"),templateId:"catalogId-tpl",data:e.data})}})};function u(){$(".delect").off().on("click",function(){var n={id:$(this).parent().attr("rid")};t.confirm({label:"删除",text:"<div style='text-align:center;font-size:13px;'>确定删除?</div>",confirmCallback:function(){e.submit({url:$.path+"/api/resCatalog/deleteResourceById",params:n,type:"get",callback:function(){e.search(a)}})}})})}function d(){$(".revoke").off().on("click",function(){var n=$(this).parent().attr("data-sign");var l={resourceId:$(this).parent().attr("rid"),resType:n};t.confirm({label:"撤销",text:"<div style='text-align:center;font-size:13px;'>确定撤销?</div>",confirmCallback:function(){e.submit({url:$.path+"/api/resource/revokePublication",params:l,type:"get",callback:function(){e.search(a)}})}})})}var p=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var t=$(this).attr("key");$("#status").val(t);e.search(a)})};var f=function(){t.scroll({container:$(".ui-gridbar")})};return{main:function(){f();s();p();o();r();b()}}});