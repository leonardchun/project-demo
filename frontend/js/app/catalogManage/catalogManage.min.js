define(["base","app/commonApp"],function(t,e){var n=null;var a=null;var c=null;var i=null;var o=null;var l=function(t,a,l){i=l;if(o!=l.level){n=null}o=l.level;if(l.level==1){$("#parent_menu").show();$("#child_menu").hide();$(c).each(function(t,a){if(l.id==a.id){if(!n){b(1)}else{e.search(n)}}})}else{$("#parent_menu").hide();$("#child_menu").show();$(c).each(function(t,a){if(l.id==a.id){if(!n){b()}else{e.search(n)}}})}};function r(){$(".input-group-addon").on("click",function(){var t=$(".search-box input").val()})}function s(t,e){if(e.id==0){return false}}var u=function(){t.ajax({url:$.path+"/api/catalog/findResourceCatalogTree",type:"get",success:function(n){c=n.data;a=t.tree({container:$("#treebar"),setting:{data:{simpleData:{enable:true}},callback:{onClick:l,beforeClick:s}},data:e.mergeTreeData(n.data,"-1"),selectNodeId:"feb08c1bac3f4e7593751bc4fa1589f3"})},beforeSend:function(){t.loading($("#treebar"))}});t.scroll({container:$("#treeAside"),callback:function(){t.pull({container:$("#treeAside"),target:$("#rightPage")})}})};var d={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/catalog/findCatalogList",type:"get",contentType:"application/json",data:function(t){return{id:i.id}}},columns:[{data:"id",sWidth:"8%"},{data:"name",sWidth:"15%"},{data:"code",sWidth:"15%"},{data:"ename",sWidth:"16%"},{data:"auditorUserName",sWidth:"16%"},{data:"telphone",sWidth:"15%"},{data:"auditorCompany",sWidth:"15%"}],columnDefs:[{render:function(t,e,n,a){return"<input type='checkbox' name='cb' value='"+n.id+"' class='cb' cid='"+JSON.stringify(n)+"'/>"},targets:0}],drawCallback:function(n){t.selectAll($("#cball"),$(".cb"),function(){e.checkByGridButton($(".cb"))})}};var f={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,ajax:{url:$.path+"/api/resCatalog/getResCatalogListByCatalogId",type:"get",contentType:"application/json",data:function(t){return{id:i.id}}},columns:[{data:"id",sWidth:"8%"},{data:"resName",sWidth:"19%"},{data:"resType",sWidth:"18%"},{data:"equipmentName",sWidth:"19%"},{data:"companyName",sWidth:"19%"},{data:"stateName",sWidth:"18%"}],columnDefs:[{render:function(t,e,n,a){return"<input type='checkbox' name='cb' value='"+n.id+"' class='cb' cid=''/>"},targets:0},{render:function(t,e,n,a){switch(n.resType){case"1":return"数据库";break;case"2":return"文件";break;case"3":return"API";break}},targets:2}],drawCallback:function(n){t.selectAll($("#cball1"),$(".cb"),function(){e.checkByGridButton($(".cb"))})}};var b=function(a){if(a==1){n=t.datatables({container:$("#example"),option:d,filter:e.gridFilter})}else{n=t.datatables({container:$("#example1"),option:f,filter:e.gridFilter})}};var g=function(){$("#search").on("click",function(){e.search(n)})};var m=function(){$("#reset").on("click",function(){e.reset($("#search-form"),n)})};var h=function(){$(".ui-grid-buttonbar .add").on("click",function(){y()});$(".ui-grid-buttonbar .delete").on("click",function(){if($(this).hasClass("disabled")){return}else{k()}});$(".ui-grid-buttonbar .modify").on("click",function(){if($(this).hasClass("disabled")){return}else{var t=$(this).attr("key");switch(t){case"1":p();break;case"2":w();break;case"3":v();break}}});$(".ui-grid-buttonbar #catalog").on("click",function(){C()});$(".import").click(function(){$("#file").trigger("click")});$(".export").click(function(){var t=o==1?"/api/catalog/downloadCatalog?resDomainId="+i.id:"/api/resCatalog/downloadResCatalog?catalogId="+i.id;window.location.href=$.path+t})};var p=function(){$("#button_type").val("1");var a={cid:$(".ui-grid .cb:checked").attr("cid")};var c=t.modal({width:800,height:250,label:"修改",url:"../html/catalogManage/catalogManage_add.html",buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){var a=t.form.validate({form:$("#form"),checkAll:true});if(!a){return}var i=t.form.getParams($("#form"));if(i){e.submit({url:"../json/submitSuccess.json",params:i})}c.hide();e.search(n)}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){e.reset($("#form"))}}]})};var k=function(){var a={ids:t.getCR("cb",true)};t.confirm({confirmCallback:function(){e.submit({url:"../json/submitSuccess.json",params:a,callback:function(){e.search(n)}})}})};var v=function(){var a={ids:t.getCR("cb",true)};t.confirm({label:"提交",context:"确认是否提交",confirmCallback:function(){e.submit({url:"../json/submitSuccess.json",params:a,callback:function(){e.search(n)}})}})};var y=function(){$("#button_type").val("");var a=t.modal({width:800,height:250,label:"新建",url:"../html/catalogManage/catalogManage_add.html",buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){var c=t.form.validate({form:$("#form"),checkAll:true});if(!c){return}var i=t.form.getParams($("#form"));if(i){e.submit({url:"../json/submitSuccess.json",params:i})}a.hide();e.search(n)}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){e.reset($("#form"))}}],callback:function(){var e=t.form.treeSelect({container:$("#hy"),url:"../json/tree.json"})}})};var w=function(){modal=t.modal({width:900,height:450,label:"编目",url:"../html/catalogManage/catalogManage_flow_step.html",callback:function(){x()},buttons:[{label:"关闭",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(t){modal.hide()}}]})};var C=function(){modal=t.modal({width:900,height:450,label:"编目",url:"../html/catalogManage/catalogManage_step.html",callback:function(){j();var e=t.form.treeSelect({container:$("#tree-select"),url:"../json/tree.json"})},buttons:[{label:"上一步",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(t){steps.back()}},{label:"下一步",id:"step_forward",cls:"btn btn-info forward",style:"display:none",clickEvent:function(){steps.forward(function(){var e=steps.getStep();switch(e){case 0:var n=t.form.validate({form:$("#form1"),checkAll:true});return n;break;case 1:var n=t.form.validate({form:$("#form2"),checkAll:true});return n;break;case 2:return true;break}})}},{label:"保存",id:"step_confirm",cls:"btn btn-info confirm",style:"display:none",clickEvent:function(){var a=t.form.validate({form:$("#form4"),checkAll:true});e.search(n);modal.hide()}}]})};var j=function(){steps=t.steps({container:$("#ui-steps"),data:[{label:"编写项目申请",contentToggle:"#content1"},{label:"填写元数据",contentToggle:"#content2",callback:function(){_()}},{label:"编辑数据项",contentToggle:"#content3",callback:function(){T()}},{label:"编目预览",contentToggle:"#content4"}],buttonGroupToggle:modal.modalFooter})};var x=function(){steps=t.steps({container:$("#ui-steps"),data:[{label:"编写项目申请",contentToggle:"#content1"},{label:"填写元数据",contentToggle:"#content2",callback:function(){}},{label:"编辑数据项",contentToggle:"#content3",callback:function(){}},{label:"编目预览",contentToggle:"#content4"}],buttonGroupToggle:modal.modalFooter,currentStep:2})};var T=function(){var e={};e.grid=null;e.count=0;e.gridContainer=$("#step_table");e.gridOption={processing:true,serverSide:false,searching:false,ordering:false,lengthChange:false,bPaginate:false,bInfo:false,drawCallback:function(){e.gridContainer.find("tbody .delete").unbind("click").on("click",function(){e.grid.deleteRow(this)})}};e.init=function(){e.grid=t.datatables({container:e.gridContainer,option:e.gridOption});e.setAddRow();e.grid.addRow(e.getRowData())};e.setAddRow=function(){$("#addRow").on("click",function(){e.grid.addRow(e.getRowData())})};e.setDeleteRow=function(){e.gridContainer.find("tbody .delete").on("click",function(){e.grid.deleteRow(this)})};e.getRowData=function(){var t=["<input type='text' name='name"+e.count+"' class='form-control'/>","<input type='text' name='name"+e.count+"' class='form-control'/>","<input type='text' name='name"+e.count+"' class='form-control'/>","<input type='text' name='name"+e.count+"' class='form-control'/>","<input type='text' name='name"+e.count+"' class='form-control'/>","<input type='text' name='name"+e.count+"' class='form-control'/>","<div style='text-align:center'><button class='btn btn-link delete' key='"+e.count+"'><i class='fa fa-trash-o'></i></button><button class='btn btn-link primary'><i class='fa fa-key'></i></button></div>"];e.count++;return t};e.init()};var _=function(){$("#imageBtn").on("click",function(){$("#image").click()});$("#image").on("change",function(){$("#fileName").html($(this).val())})};var R=function(){t.scroll({container:$(".ui-gridbar")})};return{main:function(){n=null;R();u();h();g();m();r()}}});