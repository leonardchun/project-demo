define(["base","app/commonApp"],function(e,t){var a=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/sysuser/findSysUser",type:"get",data:function(a){t.gridPageFliter(a);var r=e.form.getParams($("#search-form"));var n;if(r){return n=$.extend(r,{page:a.page,size:a.size})}}},columns:[{data:"id",sWidth:"5%"},{data:"loginName",sWidth:"15%"},{data:"userName",sWidth:"15%"},{data:"roleName",sWidth:"12%"},{data:"telphone",sWidth:"11%"},{data:"cellPhoneNumber",sWidth:"11%"},{data:"email",sWidth:"11%"},{data:"state",sWidth:"10%"}],columnDefs:[{render:function(e,t,a,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+a.id+"' class='cb' cid='"+a.id+"'/></div>"},targets:0},{render:function(e,t,a,r){return"<div cid='"+a.id+"' class='loginName' style='cursor:pointer'>"+a.loginName+"</div>"},targets:1},{render:function(e,t,a,r){if(a.telphone){return"<div>"+a.telphone+"</div>"}else{return"--"}},targets:4},{render:function(e,t,a,r){if(a.cellPhoneNumber){return"<div>"+a.cellPhoneNumber+"</div>"}else{return"--"}},targets:5},{render:function(e,t,a,r){if(a.email){return"<div>"+a.email+"</div>"}else{return"--"}},targets:6},{render:function(e,t,a,r){switch(a.state){case"0":return"正常";break;case"-1":return"停用";break;default:return"停用";break}},targets:7}],drawCallback:function(a){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))});n()}};function n(){$(".loginName").off().on("click",function(){m($(this).attr("cid"))})}var i=function(){a=e.datatables({container:$("#user"),option:r,filter:t.gridFilter})};var s=function(){$.ajax({type:"get",url:$.path+"/api/sysroles/findRoleList",success:function(t){e.template({container:$(".resTypeName"),templateId:"userRole-tpl",data:t.data})}})};var c=function(){$(".ui-grid-buttonbar .add").on("click",function(){l()});$(".ui-grid-buttonbar .delete").on("click",function(){if($(this).hasClass("disabled")){return}else{o()}});$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){var e=$(this).attr("keyAtrr");switch(e){case"0":d();break;case"2":b();break;case"3":h();break;case"4":p();break}}})};var l=function(){var r=e.modal({label:"新建",width:850,height:210,url:"../html/systemManage/userOperation/create.html",drag:true,buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var n=e.form.getParams($("#form"));if(n)if(n){t.submit({url:$.path+"/api/sysuser/saveSysUser",params:n,type:"post",callback:function(){t.search(a)}});r.hide()}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var o=function(){var r=e.getChecks("cb");e.confirm({confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/deleteSysUser",params:r,type:"post",callback:function(){t.search(a)}})}})};var u=function(){$("#search").on("click",function(){t.search(a)})};var f=function(){$("#reset").on("click",function(){t.reset($("#search-form"),a)})};var d=function(){var r={roleid:$(".ui-grid .cb:checked").attr("cid")};var n=e.modal({label:"修改",width:850,height:210,url:"../html/systemManage/userOperation/modify.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysuser/findSysUserById?id="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){var a=t.data;e.form.init(a,$("#form"));$("#form").find("input[name='loginName']").attr("disabled",true);$("#form").find("input[name='userName']").attr("disabled",true);$("#form").find("select[name='roleId']").append("<option value='"+a.roleId+"'>"+a.roleName+"</option>").attr("disabled",true)}},error:function(e){}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var r=e.form.getParams($("#form"));if(r){t.submit({url:"../json/submitSuccess.json",params:r});n.hide();t.search(a)}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var m=function(t){var a=e.modal({label:"查看",width:850,height:210,url:"../html/systemManage/userOperation/view.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysuser/findSysUserById?id="+t,type:"get",success:function(e){if(e.code=="0"){var t=e.data;$.each(t,function(e,t){if(e=="state"){if(t=="0"){$("#form .state").html("正常")}else if(t=="-1"){$("#form .state").html("停用")}else{$("#form .state").html("停用")}}else{if(t){$("#form").find("."+e).html(t)}else{$("#form").find("."+e).html("--")}}})}},error:function(e){}})},buttons:[{label:"取消",cls:"btn btn-info",clickEvent:function(){a.hide()}}]})};var b=function(){e.confirm({label:"停用",text:"<div style='text-align:center;font-size:13px;'>确定停用?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/startOrStopSysUser?id="+$(".ui-grid .cb:checked").attr("cid")+"&state=-1",type:"get",callback:function(){t.search(a)}})}})};var h=function(){e.confirm({label:"启用",text:"<div style='text-align:center;font-size:13px;'>确定启用?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/startOrStopSysUser?id="+$(".ui-grid .cb:checked").attr("cid")+"&state=0",type:"get",callback:function(){t.search(a)}})}})};var p=function(){var r={id:e.getCR("cb",true)};e.confirm({label:"告警信息",text:"<div style='text-align:center;font-size:13px;'>确定重置密码?</div>",confirmCallback:function(){t.submit({url:$.path+"/api/sysuser/resetUserPassword",type:"get",params:r,callback:function(){t.search(a)}})}})};var g=function(){$("#form").find("input[name='loginName']").on("focus",function(){}).on("blur",function(){var t={loginName:$(this).val()};e.ajax({type:"get",url:$.path+"/api/sysuser/checkLoginName",params:t,success:function(t){e.requestTip("可用")}})})};return{main:function(){i();c();s();u();f()}}});