define(["base","app/commonApp"],function(t,n){var e=null;var a=null;var i=null;var c=null;var o=null;var r=function(t,a,c){$(i).each(function(t,a){if(c.id==a.id){$("#currentTreeId").val(a.id);if(!e){u()}else{n.search(e)}}})};var l=function(){t.ajax({url:"../json/tree.json",type:"get",success:function(n){i=n;a=t.tree({container:$("#treebar"),setting:{data:{simpleData:{enable:true}},callback:{onClick:r}},data:n,selectNodeId:"1"})},beforeSend:function(){t.loading($("#treebar"))}});t.scroll({container:$("#treeAside"),callback:function(){t.pull({container:$("#treeAside"),target:$("#cr")})}})};var s={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,ajax:{url:"../json/grid1.json",type:"get",contentType:"application/json",data:function(t){$.extend(t,{id:$("#currentTreeId").val()});return JSON.stringify(t)}},columns:[{data:"id",sWidth:"8%"},{data:"name",sWidth:"12%"},{data:"position",sWidth:"15%"},{data:"city",sWidth:"25%"},{data:"start_date",sWidth:"25%"},{data:"salary",sWidth:"15%"}],columnDefs:[{render:function(t,n,e,a){return"<input type='checkbox' name='cb' value='"+e.id+"' class='cb' cid='"+e.id+"'/>"},targets:0},{render:function(t,n,e,a){return"<a target='_blank' href='example/detail.html?id="+e.id+"'>"+e.name+"</a>"},targets:1}],drawCallback:function(e){t.selectAll($("#cball"),$(".cb"),function(){n.checkByGridButton($(".cb"))})}};var u=function(){e=t.datatables({container:$("#example"),option:s});t.scroll({container:$(".ui-gridbar")})};var d=function(){$("#search").on("click",function(){n.search(e)})};var f=function(){$("#reset").on("click",function(){n.reset($("#search-form"),e)})};var b=function(){$(".ui-grid-buttonbar .add").on("click",function(){h()});$(".ui-grid-buttonbar .delete").on("click",function(){if($(this).hasClass("disabled")){return}else{g()}});$(".ui-grid-buttonbar .modify").on("click",function(){if($(this).hasClass("disabled")){return}else{m()}})};var m=function(){var a={cid:$(".ui-grid .cb:checked").attr("cid")};c=t.modal({width:800,height:400,label:"修改",url:"../html/example/grid_modify.html",buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){var a=t.form.validate({form:$("#form"),checkAll:true});if(!a){return}var i=t.form.getParams($("#form"));if(i){n.submit({url:"../json/submitSuccess.json",params:i})}c.hide();n.search(e)}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){n.reset($("#form"))}}]})};var g=function(){var a={ids:t.getChecks("cb")};t.confirm({confirmCallback:function(){n.submit({url:"../json/submitSuccess.json",params:a,callback:function(){n.search(e)}})}})};var h=function(){c=t.modal({width:900,height:450,label:"新建",url:"../html/example/tree_step.html",callback:function(){p()},buttons:[{label:"上一步",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(t){o.back()}},{label:"下一步",id:"step_forward",cls:"btn btn-info forward",style:"display:none",clickEvent:function(){o.forward(function(){var n=o.getStep();switch(n){case 0:var e=t.form.validate({form:$("#form1"),checkAll:true});return e;break;case 1:var e=t.form.validate({form:$("#form2"),checkAll:true});return e;break;case 2:return true;break}})}},{label:"保存",id:"step_confirm",cls:"btn btn-info confirm",style:"display:none",clickEvent:function(){var a=t.form.validate({form:$("#form4"),checkAll:true});n.search(e);c.hide()}}]})};var p=function(){o=t.steps({container:$("#ui-steps"),data:[{label:"编写项目申请",contentToggle:"#content1"},{label:"填写元数据",contentToggle:"#content2",callback:function(){v()}},{label:"编辑数据项",contentToggle:"#content3",callback:function(){k()}},{label:"编目预览",contentToggle:"#content4"}],buttonGroupToggle:c.modalFooter})};var k=function(){var n={};n.grid=null;n.count=0;n.gridContainer=$("#step_table");n.gridOption={processing:true,serverSide:false,searching:false,ordering:false,lengthChange:false,bPaginate:false,bInfo:false,drawCallback:function(){n.gridContainer.find("tbody .delete").unbind("click").on("click",function(){n.grid.deleteRow(this)})}};n.init=function(){n.grid=t.datatables({container:n.gridContainer,option:n.gridOption});n.setAddRow();n.grid.addRow(n.getRowData())};n.setAddRow=function(){$("#addRow").on("click",function(){n.grid.addRow(n.getRowData())})};n.setDeleteRow=function(){n.gridContainer.find("tbody .delete").on("click",function(){n.grid.deleteRow(this)})};n.getRowData=function(){var t=["<input type='text' name='name"+n.count+"' class='form-control'/>","<input type='text' name='name"+n.count+"' class='form-control'/>","<input type='text' name='name"+n.count+"' class='form-control'/>","<input type='text' name='name"+n.count+"' class='form-control'/>","<input type='text' name='name"+n.count+"' class='form-control'/>","<input type='text' name='name"+n.count+"' class='form-control'/>","<div style='text-align:center'><button class='btn btn-link delete' key='"+n.count+"'><i class='fa fa-trash-o'></i></button><button class='btn btn-link primary'><i class='fa fa-key'></i></button></div>"];n.count++;return t};n.init()};var v=function(){$("#imageBtn").on("click",function(){$("#image").click()});$("#image").on("change",function(){$("#fileName").html($(this).val())})};return{main:function(){l();u();b();f()}}});