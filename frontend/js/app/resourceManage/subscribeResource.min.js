define(["base","app/commonApp"],function(t,e){var a=null;var n=function(t,e,a){var n="";switch(t){case"1":n="<div rid='"+e+"' data-sign='"+a+"'><button class='btn btn-link blockCenter disabled'>撤销</button><button class='btn btn-link blockCenter disabled'>评价</button>"+"<button class='btn btn-link blockCenter disabled' >删除</button></div>";break;case"2":n="<div rid='"+e+"' data-sign='"+a+"'><button class='revoke btn blockCenter btn-warning'>撤销</button><button class='btn btn-link blockCenter doComment color-59b0fc'>评价</button>"+"<button class='btn btn-link blockCenter disabled'>删除</button></div>";break;case"3":n="<div rid='"+e+"' data-sign='"+a+"'><button class='btn btn-warning delect'>删除</button><button class='btn btn-link blockCenter disabled'>撤销</button>"+"<button class='btn btn-link blockCenter disabled'>评论</button></div>";break;case"4":n="<div rid='"+e+"' data-sign='"+a+"'><button class='btn btn-warning delect'>删除</button><button class='btn btn-link blockCenter disabled'>撤销</button>"+"<button class='btn btn-link blockCenter disabled'>评论</button></div>";break;case"5":n="<div rid='"+e+"' data-sign='"+a+"'><button class='btn btn-warning delect'>删除</button><button class='btn btn-link blockCenter disabled'>撤销</button>"+"<button class='btn btn-link blockCenter disabled'>评论</button></div>";break}return n};var i={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/subscribeResource/findMySubscribeResourcePage",type:"get",data:function(a){e.gridPageFliter(a);var n=t.form.getParams($("#search-form"));if(n.state=="0"){delete n["state"]}if(n){var i=$.extend({page:a.page,size:a.size},n)}return i}},columns:[{data:"data",sWidth:"100%"}],columnDefs:[{render:function(t,e,a,i){var l=n(a.state,a.id,a.resType);var s="";var c=a.content;switch(a.resType){case"1":s="<span class='sign color-1e88e5'>"+a.resTypeName+"</span>";break;case"2":s="<span class='sign color-fe245c'>"+a.resTypeName+"</span>";break;case"3":s="<span class='sign color-f2c65d'>"+a.resTypeName+"</span>";break;case"其他":s="<span class='sign color-68baff'>"+a.resTypeName+"</span>";break}if(a.abstracts.length>150){c=a.abstracts.substr(0,150)+"..."}else{c=a.abstracts}var r="<div class='ui-blockGrid-item'>"+"<ul>"+"<li type='photo' style='float:left;width:12%'>"+"<img src='../images/user_default.png'/>"+"</li>"+"<li type='info' style='float:left;width:59%'>"+"<ul class='ui-blockGrid-content'>"+"<li type='title'><a target='_blank' href='"+$.path+"/dssg-portal/index.html#/detail?type="+a.resType+"&id="+a.id+"'>"+a.resName+s+"</a></li>"+"<li class='content'>"+c+"</li>"+"<li style='clear:both;padding-left:22px'>"+"<div class='classify'>"+a.subjectCarategoryName+"</div>"+"<div class='classify'>"+a.industryCategoryName+"</div>"+"</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>提供单位</li>"+"<li type='content'>"+a.publishDept+"</li>"+"<li class='viewApplication' cid='"+a.id+"' style='cursor:pointer;color:#59b0fc' type='viewApplication'>查看申请</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>申请状态</li>"+"<li type='content'>"+a.stateName+"</li>"+"</ul>"+"</li>"+"<li type='buttons' style='float:left;width:11%'>"+l+"<div class='ui-datetime'>"+a.applyTime+"</div></li>"+"</ul>"+"</div>";return r},targets:0}],drawCallback:function(t){l();s();c();o()}};function l(){$(".delect").off().on("click",function(){var n={id:$(this).parent().attr("rid")};t.confirm({label:"删除",text:"<div style='text-align:center;font-size:13px;'>确定删除?</div>",confirmCallback:function(){e.submit({url:$.path+"/api/subscribeResource/deleteSubscribe",params:n,type:"get",callback:function(){e.search(a)}})}})})}function s(){$(".revoke").off().on("click",function(){var n=$(this).parent().attr("data-sign");var i={subscribeId:$(this).parent().attr("rid"),resType:n};t.confirm({label:"撤销",text:"<div style='text-align:center;font-size:13px;'>确定撤销?</div>",confirmCallback:function(){e.submit({url:$.path+"/api/subscribeResource/revokeSubscribe",params:i,type:"get",callback:function(){e.search(a)}})}})})}var c=function(){$(".doComment").off().on("click",function(){})};var r=function(e,a){if(e=="1"){e="1"}else{e="2"}$(".cont").removeClass("hidden").addClass("hidden");$("#content"+e).removeClass("hidden");if(a=="3"){$(".apiformExample").show()}else{$(".formExample").show()}var n=t.steps({container:$("#ui-steps"),data:[{label:"申请订阅",contentToggle:"#content0"},{label:"订阅审批",contentToggle:"#content1"},{label:"完成订阅",contentToggle:"#content2"}],buttons:[],currentStep:parseInt(e)})};var o=function(){$(".viewApplication").off().on("click",function(){var e={id:$(this).attr("cid")};var a=t.modal({width:1e3,height:460,label:"订阅流程信息",url:"../html/resourceManage/checkApplication.html",callback:function(){t.ajax({url:$.path+"/api/subscribeReview/subscriptionApprovalProcessView",type:"post",params:e,success:function(t){if(t.code=="0"){var t=t.data[0];r(t.state,t.resType);for(var e in t){if(t.resType=="3"){var a=$(".apiformExample")}else{var a=$(".formExample")}if(t[e]){if(e=="resType"){var n=t[e]=="1"?"数据库":t[e]=="2"?"文件":"API";a.find("."+e).html(n)}else if(e=="model"){var n=t[e]=="1"?"完全":t[e]=="2"?"映射":"";a.find("."+e).html(n)}else{a.find("."+e).html(t[e])}}else{a.find("."+e).html("--")}}}},error:function(t){}})},buttons:[{label:"返回",cls:"btn btn-info",clickEvent:function(){a.hide()}}]})})};var b=function(){a=t.datatables({container:$("#example"),option:i,filter:e.gridFilter})};var d=function(){$("#search").on("click",function(){e.search(a)})};var u=function(){$("#reset").on("click",function(){e.reset($("#search-form"),a)})};var f=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var t=$(this).attr("key");$("#status").val(t);e.search(a)})};var p=function(){t.scroll({container:$(".ui-gridbar")})};var v=function(){$.ajax({type:"get",url:$.path+"/api/catalog/findDomainResCataLogInfo?name=catalogId&type=1",success:function(e){t.template({container:$(".catalogId"),templateId:"catalogId-tpl",data:e.data})}})};return{main:function(){v();p();b();f();d();u()}}});