define(["base","app/commonApp"],function(e,t){var a=null;var c=function(e,t,a){var c="";switch(e){case 1:c="<div class='occupied'>撤销</div><button rid='"+t+"' type='subscribe' data-sign='"+a+"' class='btn btn-warning check'>审批</button>"+"<div class='occupied'>删除</div>";break;case 2:c="<button rid='"+t+"' type='subscribe' class='btn btn-warning'>评论</button>"+"<div class='undo color-59b0fc'>撤销</div><div class='cancel color-59b0fc'>删除</div>";break;case 3:c="<div class='occupied'>撤销</div><div class='cancel color-59b0fc'>删除</div>"+"<button class='occupied'>评论</button>";break;case 4:c="<div class='occupied'>撤销</div><div class='cancel color-59b0fc'>删除</div>"+"<button class='occupied'>评论</button>";break;case 5:c="<div class='occupied'>撤销</div><div class='cancel color-59b0fc'>删除</div>"+"<button class='occupied'>评论</button>";break}return c};var n={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:"../json/resourceManage/subscribeResource.json",type:"get",contentType:"application/json",data:function(t){var a=e.form.getParams($("#search-form"));if(a){$.extend(t,a)}return JSON.stringify(t)}},columns:[{data:"data",sWidth:"100%"}],columnDefs:[{render:function(e,a,n,l){var n=n.data;var s=t.getStar(n.star);var i=c(n.status,n.id,n.sign);var o="";var r="";var u=n.content;for(var b=1;b<=5;b++){if(b<=n.star){o+="<i class='fa fa-star color-ff9b02'></i>"}else{o+="<i class='fa fa-star'></i>"}}switch(n.sign){case"DATA":r="<span class='sign color-1e88e5'>"+n.sign+"</span>";break;case"DOC":r="<span class='sign color-fe245c'>"+n.sign+"</span>";break;case"API":r="<span class='sign color-f2c65d'>"+n.sign+"</span>";break;case"其他":r="<span class='sign color-68baff'>"+n.sign+"</span>";break}if(n.content.length>150){u=n.content.substr(0,150)+"..."}else{u=n.content}var d="<div class='ui-blockGrid-item'>"+"<ul>"+"<li type='photo' style='float:left;width:12%'>"+"<img src='"+n.photo+"'/>"+"<div class='sign-box'>"+o+"</div>"+"</li>"+"<li type='info' style='float:left;width:59%'>"+"<ul class='ui-blockGrid-content'>"+"<li type='title'><a target='_blank' href='resourceManage/resource_detail.html?id="+n.id+"'>"+n.title+r+"</a></li>"+"<li class='content'>"+u+"</li>"+"<li style='clear:both;padding-left:22px'>"+"<div class='classify'>"+n.themeClassify+"</div>"+"<div class='classify'>"+n.vacationClassify+"</div>"+"</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>提供单位</li>"+"<li type='content'>"+n.provideUnit+"</li>"+"</ul>"+"</li>"+"<li style='float:left;width:9%'>"+"<ul class='ui-blockGrid-content column-normal'>"+"<li type='title' class='color-777'>申请状态</li>"+"<li type='content'>"+n.applicationStatus+"</li>"+"</ul>"+"</li>"+"<li type='buttons' style='float:left;width:11%'>"+i+"</li>"+"</ul>"+"</div>";return d},targets:0}],drawCallback:function(e){l();$(".see-application").click(function(){u()})}};function l(){$(".check").off().on("click",function(){var c="";var n=$(this).attr("data-sign");switch(n){case"DATA":c="../html/resourceManage/subscribeResource_check_db.html";break;case"DOC":c="../html/resourceManage/subscribeResource_check_doc.html";break;case"API":c="../html/resourceManage/subscribeResource_check_api.html";break;case"其他":return;break}modal=e.modal({label:"资源订阅审批",width:1e3,height:500,modalId:$(this).attr("rid"),url:c,drag:true,callback:function(){b(n)},buttons:[{label:"上一步",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(e){steps.back()}},{label:"下一步",id:"step_forward",cls:"btn btn-info forward",style:"display:none",clickEvent:function(){steps.forward(function(){var t=steps.getStep();switch(t){case 0:var a=e.form.validate({form:$("#form1"),checkAll:true});return a;break;case 1:var a=e.form.validate({form:$("#form2"),checkAll:true});return a;break;case 2:return true;case 3:return true;case 4:return true;break}})}},{label:"保存",id:"step_confirm",cls:"btn btn-info confirm",style:"display:none",clickEvent:function(){var e={};switch(n){case"DATA":;break;case"DOC":e={applyResult:$(".doc .applyResult").val(),applyopinion:$(".applyopinion").val()};break;case"API":;break}t.search(a);modal.hide()}}]})})}var s=function(){a=e.datatables({container:$("#example"),option:n})};var i=function(){$("#search").on("click",function(){t.search(a)})};var o=function(){$("#reset").on("click",function(){t.reset($("#search-form"),a)})};var r=function(){$(".ui-grid-linkGroup li").on("click",function(){$(".ui-grid-linkGroup .active").removeClass("active");$(this).addClass("active");var e=$(this).attr("key");$("#status").val(e);t.search(a)})};var u=function(){modal=e.modal({width:900,height:450,label:"查看",url:"../html/resourceManage/subscribeExamine_step.html",callback:function(){b()},buttons:[{label:"关闭",id:"step_back",cls:"btn btn-info back",style:"display:none",clickEvent:function(e){modal.hide()}}]})};var b=function(t){var a=[];switch(t){case"DATA":a=[{label:"查看请求方信息",contentToggle:"#content1"},{label:"查看元数据信息",contentToggle:"#content2"},{label:"数据处理策略",contentToggle:"#content3"},{label:"填写审批意见",contentToggle:"#content4"}];break;case"DOC":a=[{label:"查看请求方信息",contentToggle:"#content1"},{label:"查看元数据信息",contentToggle:"#content2"},{label:"填写审批意见",contentToggle:"#content3"}];break;case"API":a=[{label:"查看请求方信息",contentToggle:"#content1"},{label:"查看元数据信息",contentToggle:"#content2"},{label:"入参处理策略",contentToggle:"#content3"},{label:"出参处理策略",contentToggle:"#content4"},{label:"服务控制策略",contentToggle:"#content5"},{label:"填写审批意见",contentToggle:"#content6"}];break}steps=e.steps({container:$("#ui-steps"),data:a,buttonGroupToggle:modal.modalFooter})};var d=function(){e.scroll({container:$(".ui-gridbar")})};return{main:function(){d();s();r();i();o()}}});