define(["base","app/commonApp"],function(e,t){var a=null;var r={processing:true,serverSide:true,searching:false,ordering:false,lengthChange:false,pagingType:"full_numbers",ajax:{url:$.path+"/api/sysroles/findSysRolesByPage",type:"get",data:function(e){t.gridPageFliter(e);return{page:e.page,size:e.size}}},columns:[{data:"id",sWidth:"10%"},{data:"roleName",sWidth:"15%"},{data:"des",sWidth:"25%"},{data:"menu",sWidth:"50%"}],columnDefs:[{render:function(e,t,a,r){return"<div class='checkboxWrapper'><input type='checkbox' name='cb' value='"+a.roleId+"' class='cb' ccode = '' cid='"+a.roleId+"'/></div>"},targets:0},{render:function(e,t,a,r){var n=a.name;if(n){return"<div title='"+n+"'>"+n+"</div>"}else{return""}},targets:1},{render:function(e,t,a,r){var n=a.description;if(n){if(n.length>20){return"<div title='"+n+"'>"+n.substr(0,20)+"...</div>"}else{return"<div title='"+n+"'>"+n+"</div>"}}else{return"--"}},targets:2},{render:function(e,t,a,r){var n=a.menus;if(n){if(n.length>50){return"<div title='"+n+"'>"+n.substr(0,40)+"...</div>"}else{return"<div title='"+n+"'>"+n+"</div>"}}else{return"--"}},targets:3}],drawCallback:function(a){e.selectAll($("#cball"),$(".cb"),function(){t.checkByGridButton($(".cb"))})}};var n=function(){a=e.datatables({container:$("#role"),option:r,filter:t.gridFilter})};var i=function(){$(".ui-grid-buttonbar .add").on("click",function(){l()});$(".ui-grid-buttonbar .delete").on("click",function(){if($(this).hasClass("disabled")){return}else{c()}});$(".ui-grid-buttonbar .modify").on("click",function(){if(!$(this).hasClass("disabled")){if($(this).hasClass("setting")){o()}else{s()}}})};var l=function(){var r=e.modal({label:"新建",width:600,height:210,url:"../html/systemManage/roleOperation/create.html",drag:true,buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var n=e.form.getParams($("#form"));if(n){t.submit({url:$.path+"/api/sysroles/saveSysRoles",params:n,type:"post",callback:function(){t.search(a)}});r.hide()}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var s=function(){var r={id:$(".ui-grid .cb:checked").attr("cid")};var n=e.modal({label:"修改",width:600,height:210,url:"../html/systemManage/roleOperation/modify.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysroles/findSysRolesByIdInfo?id="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){var a=t.data;e.form.init(a,$("#form"));$("#form").find("input[name='code']").attr("disabled",true)}},error:function(e){}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var i=e.form.getParams($("#form"));if(i){var l=$.extend(r,i);t.submit({url:$.path+"/api/sysroles/updateSysRoles",params:l,type:"post",callback:function(){t.search(a)}});n.hide()}}})}},{label:"重置",cls:"btn btn-warning",clickEvent:function(){t.reset($("#form"))}}]})};var c=function(){var r=e.getChecks("cb");e.confirm({confirmCallback:function(){t.submit({url:$.path+"/api/sysroles/deleteSysRoles",params:r,type:"post",callback:function(){t.search(a)}})}})};var o=function(){var r={roleid:$(".ui-grid .cb:checked").attr("cid")};var n=e.modal({label:"配置菜单",width:870,height:400,url:"../html/systemManage/roleOperation/setting.html",drag:true,callback:function(){e.ajax({url:$.path+"/api/sysmenus/findSysMenusAllList?roleId="+$(".ui-grid .cb:checked").attr("cid"),type:"get",success:function(t){if(t.code=="0"){if(t.data.roleName){$("#form").find("input[name='roleName']").val(t.data.roleName).attr("disabled",true)}var a=t.data.allMenu;var r=t.data.myMenu;tree=e.tree({container:$("#set-setting"),setting:{check:{enable:true,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},view:{selectedMulti:false,showIcon:false,showLine:false},callback:{},data:{simpleData:{enable:false,idKey:"key",pIdKey:""},key:{children:"children",name:"label",title:"key"}}},data:a,selectNodeId:"1"});var n=$.fn.zTree.getZTreeObj("set-setting");n.expandAll(true);for(var i=0;i<r.length;i++){code=n.getNodesByParamFuzzy("key",r[i],null)[0];n.checkNode(code,true,true)}}}})},buttons:[{label:"保存",cls:"btn btn-info",clickEvent:function(){e.form.validate({form:$("#form"),checkAll:true,passCallback:function(){var e=$.fn.zTree.getZTreeObj("set-setting");var i=e.getCheckedNodes(true);var l=[];i.forEach(function(e){l.push(e.key)});var s=$.extend(r,{menuids:l});t.submit({url:$.path+"/api/sysroles/assignMenus",params:s,type:"post",callback:function(){t.search(a)}});n.hide()}})}}]})};return{main:function(){n();i()}}});